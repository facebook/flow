"use strict";(self.webpackChunknew_website=self.webpackChunknew_website||[]).push([[8675],{18675:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>u});const s=JSON.parse('{"id":"enums/migrating-legacy-patterns","title":"Migrating from legacy patterns","description":"Learn how to migrate to Flow Enums from legacy JavaScript enum patterns like Object.freeze.","source":"@site/docs/enums/migrating-legacy-patterns.md","sourceDirName":"enums","slug":"/enums/migrating-legacy-patterns","permalink":"/en/docs/enums/migrating-legacy-patterns","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/flow/edit/main/website/docs/enums/migrating-legacy-patterns.md","tags":[],"version":"current","frontMatter":{"title":"Migrating from legacy patterns","slug":"/enums/migrating-legacy-patterns"},"sidebar":"docsSidebar","previous":{"title":"Using enums","permalink":"/en/docs/enums/using-enums"},"next":{"title":"Match Expressions and Statements","permalink":"/en/docs/match"}}');var a=n(74848),i=n(28453);const r={title:"Migrating from legacy patterns",slug:"/enums/migrating-legacy-patterns"},o=void 0,c={},u=[{value:"Updating definitions",id:"toc-updating-definitions",level:2},{value:"Object.freeze",id:"toc-object-freeze",level:4},{value:"keyMirror",id:"toc-keymirror",level:4},{value:"Updating usage",id:"toc-updating-usage",level:2},{value:"Fix type imports",id:"toc-fix-type-imports",level:4},{value:"If both type and value were imported",id:"toc-if-both-type-and-value-were-imported",level:5},{value:"If only the type was imported",id:"toc-if-only-the-type-was-imported",level:5},{value:"Mapping enums to other values",id:"toc-mapping-enums-to-other-values",level:4},{value:"Usage as the representation type (e.g. a string)",id:"toc-usage-as-the-representation-type-e-g-a-string",level:4},{value:"Casting to the enum type",id:"toc-casting-to-the-enum-type",level:4},{value:"Update switch statements",id:"toc-update-switch-statements",level:4},{value:"Operations over enum members",id:"toc-operations-over-enum-members",level:4}];function l(e){const t={a:"a",code:"code",h2:"h2",h4:"h4",h5:"h5",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(t.p,{children:["Learn how to migrate to Flow Enums from legacy JavaScript enum patterns like ",(0,a.jsx)(t.code,{children:"Object.freeze"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["First, learn how to ",(0,a.jsx)(t.a,{href:"#toc-updating-definitions",children:"update the enum definition site"}),", and next learn how to ",(0,a.jsx)(t.a,{href:"#toc-updating-usage",children:"update files that import and use the enum"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"toc-updating-definitions",children:"Updating definitions"}),"\n",(0,a.jsx)(t.h4,{id:"toc-object-freeze",children:"Object.freeze"}),"\n",(0,a.jsxs)(t.p,{children:["If you are using ",(0,a.jsx)(t.code,{children:"Object.freeze"}),", you can migrate to an enum if the values of the object are:"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["All the same primitive type, and that type is ",(0,a.jsx)(t.code,{children:"boolean"}),", ",(0,a.jsx)(t.code,{children:"string"}),", ",(0,a.jsx)(t.code,{children:"number"}),", or ",(0,a.jsx)(t.code,{children:"symbol"}),"."]}),"\n",(0,a.jsx)(t.li,{children:"All literals."}),"\n",(0,a.jsx)(t.li,{children:"Contain no duplicate values."}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"Replace"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-flow",metastring:"[]",children:"const Status = Object.freeze({\n  Active: 1,\n  Paused: 2,\n  Off: 3,\n});\n\nexport type StatusType = $Values<typeof Status>;\n\nexport default Status;\n"})}),"\n",(0,a.jsx)(t.p,{children:"with"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-flow",metastring:"[]",children:"export default enum Status {\n  Active = 1,\n  Paused = 2,\n  Off = 3,\n}\n"})}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Check to ensure that the key names do not start with lowercase \u2018a\u2019-\u2018z\u2019 (disallowed in enums). If they do, you\u2019ll need to rename the member names."}),"\n",(0,a.jsxs)(t.li,{children:["Remove any usage of ",(0,a.jsx)(t.code,{children:"$Keys<...>"})," or ",(0,a.jsx)(t.code,{children:"$Values<...>"})," on the enum type, these are no longer needed as a Flow Enum defines a type itself (its name)."]}),"\n",(0,a.jsx)(t.li,{children:"Delete any type exports based on the enum, as you just need to export the Flow Enum. A Flow Enum acts as both a type and a value (like a class)."}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["Then, take a look at ",(0,a.jsx)(t.a,{href:"#toc-updating-usage",children:"how to update files that import and use the enum"}),"."]}),"\n",(0,a.jsx)(t.h4,{id:"toc-keymirror",children:"keyMirror"}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.code,{children:"keyMirror"})," utility creates an object whose values are mirrors of its key names. You can replace ",(0,a.jsx)(t.code,{children:"keyMirror"})," usage with a string based enum."]}),"\n",(0,a.jsx)(t.p,{children:"Replace"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"import keyMirror from 'keyMirror';\n\nconst Status = keyMirror({\n  Active: null,\n  Paused: null,\n  Off: null,\n});\n\nexport type StatusType = $Keys<typeof Status>;\n\nexport default Status;\n"})}),"\n",(0,a.jsx)(t.p,{children:"with"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-flow",metastring:"[]",children:"export default enum Status {\n  Active,\n  Paused,\n  Off,\n}\n"})}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Check to ensure that the key names do not start with lowercase \u2018a\u2019-\u2018z\u2019 (disallowed in enums). If they do, you\u2019ll need to rename the member names."}),"\n",(0,a.jsxs)(t.li,{children:["Remove any usage of ",(0,a.jsx)(t.code,{children:"$Keys<...>"})," on the enum type, it's no longer needed as a Flow Enum defines a type itself (its name)."]}),"\n",(0,a.jsx)(t.li,{children:"Delete any type exports based on the enum, you just need to export the Flow Enum. A Flow Enum acts as both a type and a value (like a class)."}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["Then, take a look at ",(0,a.jsx)(t.a,{href:"#toc-updating-usage",children:"how to update files that import and use the enum"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"toc-updating-usage",children:"Updating usage"}),"\n",(0,a.jsx)(t.h4,{id:"toc-fix-type-imports",children:"Fix type imports"}),"\n",(0,a.jsxs)(t.p,{children:["Previous patterns required you to export (and then import) a type separate from the enum itself.\nFlow Enums are both types and values (like a class), so you just need to export the Flow Enum itself. Since there is now one export, you only need one import.\nRead more about ",(0,a.jsx)(t.a,{href:"../using-enums/#toc-exporting-enums",children:"exporting enums"})," and ",(0,a.jsx)(t.a,{href:"../using-enums/#toc-importing-enums",children:"importing enums"}),"."]}),"\n",(0,a.jsx)(t.p,{children:"If you previously had:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-flow",metastring:"[]",children:"const Status = Object.freeze({\n  Active: 1,\n  Paused: 2,\n  Off: 3,\n});\nexport type StatusType = $Values<typeof Status>;\nexport default Status;\n"})}),"\n",(0,a.jsx)(t.p,{children:"And you've replaced it with:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-flow",metastring:"[]",children:"export default enum Status {\n  Active = 1,\n  Paused = 2,\n  Off = 3,\n}\n"})}),"\n",(0,a.jsx)(t.p,{children:"Then you need to fix the imports as well:"}),"\n",(0,a.jsx)(t.h5,{id:"toc-if-both-type-and-value-were-imported",children:"If both type and value were imported"}),"\n",(0,a.jsx)(t.p,{children:"For a user of the enum, if you previously imported both the type and the value, you can delete the type import and update annotations used."}),"\n",(0,a.jsx)(t.p,{children:"Change"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"import type {StatusType} from 'status';\n\nimport Status from 'status';\n\nconst myStatus: StatusType = Status.Active;\n"})}),"\n",(0,a.jsx)(t.p,{children:"to"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"// Type import is deleted\n\nimport Status from 'status';\n\nconst myStatus: Status = Status.Active; // Changed type annotation to just `Status`\n"})}),"\n",(0,a.jsx)(t.h5,{id:"toc-if-only-the-type-was-imported",children:"If only the type was imported"}),"\n",(0,a.jsx)(t.p,{children:"For a user of the enum, if you previously imported just the type, change the type import to a default import rather than a named import."}),"\n",(0,a.jsx)(t.p,{children:"Change"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"import type {StatusType} from 'status';\n\nfunction isActive(status: StatusType) { ... }\n"})}),"\n",(0,a.jsx)(t.p,{children:"to"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"// Remove the braces `{` `}` and changed the name - this is a default import now\nimport type Status from 'status';\n\nfunction isActive(status: Status) { ... } // Changed type annotation to just `Status`\n"})}),"\n",(0,a.jsx)(t.h4,{id:"toc-mapping-enums-to-other-values",children:"Mapping enums to other values"}),"\n",(0,a.jsxs)(t.p,{children:["Sometimes you want to map from an enum value to some other value. Previously, we sometimes used object literals for this.\nWith Flow Enums, use a function with a ",(0,a.jsx)(t.code,{children:"switch"})," instead. The switch is ",(0,a.jsx)(t.a,{href:"../using-enums/#toc-exhaustively-checking-enums-with-a-switch",children:"exhaustively checked"}),",\nso Flow will ensure you update your mapping when you add or remove Flow Enum members."]}),"\n",(0,a.jsx)(t.p,{children:"Replace this pattern"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"const STATUS_ICON: {[Status]: string} = {\n  [Status.Active]: 'green-checkmark',\n  [Status.Paused]: 'grey-pause',\n  [Status.Off]: 'red-x',\n};\nconst icon = STATUS_ICON[status];\n"})}),"\n",(0,a.jsx)(t.p,{children:"with"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"function statusIcon(status: Status): string {\n  switch (status) {\n    case Status.Active:\n      return 'green-checkmark';\n    case Status.Paused:\n      return 'grey-pause';\n    case Status.Off:\n      return 'red-x';\n  }\n}\nconst icon = statusIcon(status);\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Read more about ",(0,a.jsx)(t.a,{href:"../using-enums/#toc-mapping-enums-to-other-values",children:"mapping enums to other values"}),"."]}),"\n",(0,a.jsx)(t.h4,{id:"toc-usage-as-the-representation-type-e-g-a-string",children:"Usage as the representation type (e.g. a string)"}),"\n",(0,a.jsxs)(t.p,{children:["You can't use a Flow Enum directly as its representation type (e.g. a ",(0,a.jsx)(t.code,{children:"string"}),").\nIf you get Flow errors about using an enum as its representation type, first try to refactor your code so that it expects the enum type instead of the representation type\n(e.g. change annotations from ",(0,a.jsx)(t.code,{children:"string"})," to ",(0,a.jsx)(t.code,{children:"Status"}),"). If you really want to use the enum as its representation type, you can add in explicit casts.\nSee ",(0,a.jsx)(t.a,{href:"../using-enums/#toc-casting-to-representation-type",children:"casting to representation type"}),"."]}),"\n",(0,a.jsx)(t.h4,{id:"toc-casting-to-the-enum-type",children:"Casting to the enum type"}),"\n",(0,a.jsxs)(t.p,{children:["If before you cast from an enum's representation type (e.g. ",(0,a.jsx)(t.code,{children:"string"}),") to the enum type with something like this:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"function castToStatus(input: number): StatusType | void {\n  switch(input) {\n    case 1: return Status.Active;\n    case 2: return Status.Paused;\n    case 3: return Status.Off;\n    default: return undefined;\n  }\n}\n\ncastToStatus(x);\n"})}),"\n",(0,a.jsxs)(t.p,{children:["You can now just use the ",(0,a.jsx)(t.a,{href:"../using-enums/#toc-cast",children:"cast"})," method:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"Status.cast(x);\n"})}),"\n",(0,a.jsx)(t.h4,{id:"toc-update-switch-statements",children:"Update switch statements"}),"\n",(0,a.jsxs)(t.p,{children:["Flow Enums are exhaustively checked in ",(0,a.jsx)(t.code,{children:"switch"})," statements. You might need to update your code when you are switching over an enum value.\nRead more at ",(0,a.jsx)(t.a,{href:"../using-enums/#toc-exhaustively-checking-enums-with-a-switch",children:"exhaustively checking enums in switch statements"}),"."]}),"\n",(0,a.jsx)(t.h4,{id:"toc-operations-over-enum-members",children:"Operations over enum members"}),"\n",(0,a.jsxs)(t.p,{children:["If previously you used functionality like ",(0,a.jsx)(t.code,{children:"Object.values"}),", ",(0,a.jsx)(t.code,{children:"Object.keys"}),", or ",(0,a.jsx)(t.code,{children:"for-in"})," loops to get and operate on the enum members,\nyou can use the ",(0,a.jsx)(t.a,{href:"../using-enums/#toc-members",children:"members method"})," instead."]})]})}function d(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var s=n(96540);const a={},i=s.createContext(a);function r(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);